# ESP32CurrentSensor
## 概要
このコードは個人で開発を行っている「電気使い過ぎ防止システム」の電流センサー部分で使用するものです。
ESP32で分電盤やコンセントから供給される交流電流を測定し、電流値をディスプレイに表示することができます。
外部と通信する機能については、今後実装予定です。

### 電気使い過ぎ防止システムとは？
「電気使い過ぎ防止システム」は、電気の使い過ぎにより家庭や施設のブレーカーが落ちることを未然に防ぐための仕組みです。
学校で授業を受けている際、ブレーカーが落ちて授業が止まってしまうことが多いことがきっかけで開発に着手しました。

### 電気使い過ぎ防止システムの機能
使い過ぎを防止したい箇所の電気配線に専用のセンサー機器を設置し電流を定期的に測定します。
そして、電流の測定値が基準値を上回った際に、専用の通知装置から電気の使い過ぎを警告します。
警告は音や光によるもので、施設利用者に対し電気使用量削減を促します。

## 機能
【交流電流測定機能】
分電盤やコンセントから供給される交流電流を、ESP32に接続した変流器(CT)を用いて測定することができます。
測定結果は電流値(A)としてI2C接続のキャラクタディスプレイに表示されます。

## 動作環境
* 動作ハードウェア:ESP32
    * MicroPythonのファームウェアがインストール済であること
    * CTによる測定回路を接続していること（詳しくは[使い方](#使い方)を参照）
* 対応ディスプレイ:AQM1602XA-RN-GBW(I2C接続)

## 使い方
![入力電圧波形のイメージ](images/wave.png)
[測定回路](#測定回路)の例を参考に、CTの2次側に精度の高い測定用抵抗を取り付けます。この測定用抵抗の両端の電圧に+0.55Vを加えたものをGPIO32に入力してください。

なお、プログラムでは測定条件の規定値が設定されており、これ以外の条件で測定を行う場合はプログラムを修正する必要があります。

> 規定値:測定抵抗…10Ω　CTの変流比…3000:1

修正方法は、main.pyを開き、

```
current = measureRMSCurrent(adc32, ratio, resistance)
# 21行目
```
上記の`ratio`の部分に変流比[ratio:1]を、`resistance`の部分に測定用抵抗[Ω]の値を、それぞれ入力します。

## 測定回路
### 回路図
![測定回路図画像](images/circuit.png)
I2C端子はディスプレイの、CT_IN端子はCTの接続部分です。R3の規定値は2kΩです。微調整のため、可変抵抗となっています。
